{% extends 'default.html' %}
{% load censor %}
{% load custom_tags %}

{% block title %}–ü—É–±–ª–∏–∫–∞—Ü–∏–∏{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>–ü—É–±–ª–∏–∫–∞—Ü–∏–∏</h1>
</div>

{% if messages %}
<div class="mb-4">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert">
            {{ message|safe }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    {% endfor %}
</div>
{% endif %}


<!-- –¢–ê–ë–´ -->
<div class="d-flex justify-content-center mb-4">

    <a href="?type=news"
       class="btn mx-2 {% if current_type == 'news' %}btn-primary{% else %}btn-outline-primary{% endif %}">
        üì∞ –ù–æ–≤–æ—Å—Ç–∏
    </a>

    <a href="?type=article"
       class="btn mx-2 {% if current_type == 'article' %}btn-primary{% else %}btn-outline-primary{% endif %}">
        üìÑ –°—Ç–∞—Ç—å–∏
    </a>

</div>

<!-- –ü–û–ò–°–ö -->
<form method="get" class="mb-4">

    <input type="hidden" name="type" value="{{ current_type }}">

    {% for key, val in request.GET.items %}
        {% if key != 'search' and key != 'page' and key != 'type' %}
            <input type="hidden" name="{{ key }}" value="{{ val }}">
        {% endif %}
    {% endfor %}

    <div class="input-group">
        <input
            type="text"
            name="search"
            class="form-control"
            placeholder="–ü–æ–∏—Å–∫ –ø–æ –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º..."
            value="{{ request.GET.search|default:'' }}"
        >
        <button class="btn btn-primary">–ù–∞–π—Ç–∏</button>
    </div>

</form>

<!-- BUTTONS -->
<div class="d-flex justify-content-between mb-4">
    <div>
        {% if user.is_authenticated %}
            <a href="{% url 'news_create' %}?type={{ current_type }}" class="btn btn-success">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é
            </a>

            {% if not is_author %}
                <a href="{% url 'become_author' %}" class="btn btn-warning ms-2">
                    üöÄ –°—Ç–∞—Ç—å –∞–≤—Ç–æ—Ä–æ–º
                </a>
            {% else %}
                <a href="{% url 'become_author' %}" class="btn btn-warning ms-2">
                    ‚ú® –ê–≤—Ç–æ—Ä
                </a>
            {% endif %}
        {% endif %}
    </div>

    <a href="{% url 'news_search' %}?type={{ current_type }}" class="btn btn-outline-secondary">
        üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
    </a>
</div>

<!-- LIST -->
<div class="row">

{% for n in news_list %}
<div class="col-md-6 col-lg-4 mb-4">
<div class="card h-100 shadow-sm">

    <div class="card-body">
        <h5>{{ n.title|censor }}</h5>
        <div class="text-muted small mb-2">
            {{ n.created_at|date:"d.m.Y H:i" }} ¬∑ {{ n.category.name }}
        </div>
        <p>{{ n.text|censor|truncatechars:120 }}</p>
    </div>

    <div class="card-footer bg-white text-end">
        {% if n.type == 'AR' %}
            <a href="{% url 'article_detail' n.id %}" class="btn btn-sm btn-primary">–ß–∏—Ç–∞—Ç—å</a>
        {% else %}
            <a href="{% url 'news_detail' n.id %}" class="btn btn-sm btn-primary">–ß–∏—Ç–∞—Ç—å</a>
        {% endif %}

        {% if user.is_authenticated %}
            {% if n.type == 'AR' %}
                <a href="{% url 'article_update' n.id %}" class="btn btn-sm btn-outline-warning">‚úè</a>
                <a href="{% url 'article_delete' n.id %}" class="btn btn-sm btn-outline-danger">üóë</a>
            {% else %}
                <a href="{% url 'news_update' n.id %}" class="btn btn-sm btn-outline-warning">‚úè</a>
                <a href="{% url 'news_delete' n.id %}" class="btn btn-sm btn-outline-danger">üóë</a>
            {% endif %}
        {% endif %}
    </div>

</div>
</div>
{% empty %}
<p class="text-center text-muted">–ü—É–±–ª–∏–∫–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
{% endfor %}

</div>

<!-- PAGINATION -->
{% if is_paginated %}
<nav>
<ul class="pagination justify-content-center">

{% if page_obj.has_previous %}
<li class="page-item">
  <a class="page-link" href="?{% url_replace page=page_obj.previous_page_number %}">‚Üê</a>
</li>
{% endif %}

<li class="page-item disabled">
  <span class="page-link">{{ page_obj.number }} / {{ paginator.num_pages }}</span>
</li>

{% if page_obj.has_next %}
<li class="page-item">
  <a class="page-link" href="?{% url_replace page=page_obj.next_page_number %}">‚Üí</a>
</li>
{% endif %}

</ul>
</nav>
{% endif %}

{% endblock %}
