{% extends 'default.html' %}
{% load censor %}
{% load custom_tags %}

{% block title %}–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏{% endblock %}

{% block content %}
<h1>–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</h1>

{# --- –ü–æ–∏—Å–∫ --- #}
<div class="search-box">
    <form method="get">
        <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫..." value="{{ request.GET.search|default:'' }}">

        {# —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏ –ø–æ–∏—Å–∫–µ #}
        {% for key, val in request.GET.items %}
            {% if key != 'search' and key != 'page' %}
                <input type="hidden" name="{{ key }}" value="{{ val }}">
            {% endif %}
        {% endfor %}

        <button type="submit">–ü–æ–∏—Å–∫</button>
    </form>
</div>

<hr>


<a href="{% url 'news_add' %}">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</a>
|
<a href="{% url 'news_search' %}">üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫</a>

<hr>

{# --- –°–ü–ò–°–û–ö –ù–û–í–û–°–¢–ï–ô --- #}
{% for n in news_list %}
    <div class="news-item">
        <h3>{{ n.title|censor }}</h3>

        <p><b>–ê–≤—Ç–æ—Ä:</b> {{ n.author }}</p>
        <p><b>–î–∞—Ç–∞:</b> {{ n.created_at|date:"d.m.Y H:i" }}</p>
        <p><b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> {{ n.category.name }}</p>

        <p>{{ n.text|censor|truncatechars:100 }}</p>

        <a href="{% url 'news_detail' n.id %}">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ ‚Üí</a>
        |
        <a href="{% url 'news_edit' n.id %}">‚úè –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        |
        <a href="{% url 'news_delete' n.id %}">üóë –£–¥–∞–ª–∏—Ç—å</a>
    </div>
    <hr>
{% empty %}
    <p>–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
{% endfor %}

{# --- –ü–ê–ì–ò–ù–ê–¶–ò–Ø --- #}
{% if is_paginated %}
<div style="margin-top: 20px;">

    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% for key,val in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ val }}{% endif %}{% endfor %}">
            ‚Üê –ù–∞–∑–∞–¥
        </a>
    {% endif %}

    <span style="margin: 0 10px;">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% for key,val in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ val }}{% endif %}{% endfor %}">
            –í–ø–µ—Ä–µ–¥ ‚Üí
        </a>
    {% endif %}

</div>
{% endif %}

{% endblock %}
